<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Simple GLTFLoader</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        background: #1a1a1a;
        color: white;
        font-family: Arial, sans-serif;
      }
      #info {
        background: #333;
        padding: 15px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .success {
        color: #4caf50;
      }
      .error {
        color: #f44336;
      }
    </style>
  </head>
  <body>
    <h1>Test Simple GLTFLoader</h1>

    <div id="info">
      <div id="details"></div>
    </div>

    <!-- Test avec différents CDNs -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

    <script>
      function addDetail(message, isError = false) {
        const div = document.createElement("div");
        div.textContent = message;
        div.className = isError ? "error" : "success";
        document.getElementById("details").appendChild(div);
        console.log(message);
      }

      // Vérifier THREE.js
      if (typeof THREE !== "undefined") {
        addDetail("✓ THREE.js chargé (version " + THREE.REVISION + ")");

        // Essayer de charger GLTFLoader avec différentes URLs
        const urls = [
          "https://unpkg.com/[email protected]/examples/js/loaders/GLTFLoader.js",
          "https://cdnjs.cloudflare.com/ajax/libs/three.js/r126/GLTFLoader.min.js",
          "https://cdn.jsdelivr.net/npm/three@0.126.0/examples/js/loaders/GLTFLoader.js",
          "https://raw.githubusercontent.com/mrdoob/three.js/r158/examples/js/loaders/GLTFLoader.js",
        ];

        let currentUrl = 0;

        function tryLoadGLTF() {
          if (currentUrl >= urls.length) {
            addDetail("✗ Aucune URL de GLTFLoader ne fonctionne", true);
            return;
          }

          const url = urls[currentUrl];
          addDetail("Essai URL: " + url);

          const script = document.createElement("script");
          script.src = url;

          script.onload = () => {
            if (typeof THREE.GLTFLoader !== "undefined") {
              addDetail("✓ GLTFLoader chargé avec succès depuis: " + url);

              // Test rapide du GLTFLoader
              try {
                const loader = new THREE.GLTFLoader();
                addDetail("✓ GLTFLoader instantié avec succès");

                // Test de chargement du modèle
                loader.load(
                  "game/assets/models/objects/soccer-ball.glb",
                  function (gltf) {
                    addDetail("✓ Modèle soccer-ball.glb chargé avec succès!");
                  },
                  function (progress) {
                    // Progress
                  },
                  function (error) {
                    addDetail(
                      "✗ Erreur chargement modèle: " + error.message,
                      true
                    );
                  }
                );
              } catch (e) {
                addDetail(
                  "✗ Erreur instantiation GLTFLoader: " + e.message,
                  true
                );
              }
            } else {
              addDetail("✗ GLTFLoader non disponible après chargement", true);
              currentUrl++;
              tryLoadGLTF();
            }
          };

          script.onerror = (e) => {
            addDetail("✗ Erreur chargement depuis: " + url, true);
            currentUrl++;
            tryLoadGLTF();
          };

          document.head.appendChild(script);
        }

        // Commencer les tests
        tryLoadGLTF();
      } else {
        addDetail("✗ THREE.js non chargé", true);
      }
    </script>
  </body>
</html>
